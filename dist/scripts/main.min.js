var ko=ko||{},google=google||{},mapManager=mapManager||{},TheatreMapViewModel=function(){"use strict";var e=this;e.twitterListMode=ko.observable(!0),e.markers=[],e.infoWindowsContent=ko.observableArray([]),e.activeTwitter=ko.observable(""),e.flipTwitter=function(){e.twitterListMode(!e.twitterListMode())};var t=function(t){e.markers[t].addListener("click",function(){e.openInfoWindow(t),e.activeTwitter(e.markers[t].twitterHandle)})};e.openInfoWindow=function(t){e.markers.forEach(function(e,t,a){e.infoWin.close()}),e.markers[t].infoWin.open(mapManager.map,e.markers[t])},e.printSomething=function(){console.log(e.infoWindowsContent())},e.moveMarker=function(){e.openInfoWindow(0)},e.addMarkers=function(){var a;mapManager.markerData.forEach(function(n,i){e.markers.push(new google.maps.Marker({position:mapManager.util.nullPosition,map:mapManager.map,title:n.title,twitterHandle:n.twitter})),n.position?e.markers[i].setPosition(n.position):n.address?mapManager.mapPositionAJAX(n.address,e.markers,i):e.markers[i].setMap(null),a=new google.maps.InfoWindow(mapManager.util.blankInfoWin),e.markers[i].infoWin=a,t(i);var r=e.markers[i].infoWin,o=n.title,s=n.website,l=n.blurb;o&&s&&l?mapManager.infoWindowMaker(r,o,s,l):o?mapManager.infoWinWikiAJAX(o,e.markers,i):mapManager.infoWindowMaker(r,o,s,l)}),mapManager.store()}},tmvm=new TheatreMapViewModel;ko.applyBindings(tmvm),twttr.widgets.createTimeline("694221648225001472",document.getElementById("twitter-account"),{screenName:"yyzbuddies"});var google=google||{},tmvm=tmvm||{},mapManager={initMap:function(){"use strict";var e={lat:43.657899,lng:-79.3782433};this.map=new google.maps.Map(document.getElementById("map"),{center:e,scrollwheel:!0,zoom:12,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_CENTER}}),tmvm.addMarkers()},infoWinWikiAJAX:function(e,t,a){"use strict";var n=this,i=e.replace(/ /g,"_"),r="https://en.wikipedia.org/w/api.php?action=opensearch&format=json&search="+i+"&limit=1&redirects=resolve",o=setTimeout(function(){t[a].infoWin.setContent(n.markerData[a].content)},5e3);$.ajax({url:r,dataType:"jsonp",success:function(i){clearTimeout(o);var r,s,l=i[1].length,d=t[a].infoWin;l?(r=i[3][0],s=i[2][0]):(r=n.markerData[a].website,s=n.markerData[a].blurb),n.infoWindowMaker(d,e,r,s)}})},mapPositionAJAX:function(e,t,a){"use strict";var n=this,i=e.replace(/ /g,"+"),r="https://maps.googleapis.com/maps/api/geocode/json?address="+i+"&bounds=43.573936,-79.560076|43.758672,-79.275135&key=AIzaSyA4SAawmy-oEMzdWboD0iHk9gDmmjb61o4";$.getJSON(r,function(e){var i=e.results[0].geometry.location.lat,r=e.results[0].geometry.location.lng;t[a].setPosition(new google.maps.LatLng(i,r)),n.markerData[a].position={lat:i,lng:r}}).error(function(i){console.log("We experienced a failure when making the coordinate request for "+e+" for the place called "+n.markerData[a].title),t[a].setMap(null)})},infoWindowMaker:function(e,t,a,n){"use strict";var i='<div class="info-window"><h4><a href="'+a+'">'+t+"</a></h4><p>"+n+"</p></div>";e.setContent(i)},store:function(){"use strict";console.log("storing data"),localStorage.markerData=JSON.stringify(this.markerData)},load:function(){"use strict";console.log("loading data"),this.markerData=[{twitter:"yyzbuddies",position:{lat:43.663346,lng:-79.383107},title:"Buddies in Bad Times Theatre",website:"http://buddiesinbadtimes.com/events/",blurb:"Buddies in Bad Times Theatre creates vital Canadian theatre by developing and presenting voices that question sexual and cultural norms. Built on the political and social principles of queer liberation, Buddies supports artists and works that reflect and advance these values. As the world’s longest-running and largest queer theatre, Buddies is uniquely positioned to develop, promote, and preserve stories and perspectives that are challenging and alternative."},{twitter:"tarragontheatre",position:{lat:43.674842,lng:-79.41282},title:"Tarragon Theatre",website:"http://tarragontheatre.com/now-playing/",blurb:"Tarragon Theatre’s mission is to create, develop and produce new plays and to provide the conditions for new work to thrive. To that end, the theatre engages the best theatre artists and craftspeople to interpret new work; presents each new work with high quality production values; provides an administrative structure to support new work; develops marketing strategies to promote new work; and continually generates an audience for new work."},{twitter:"beyondwallsTPM",position:{lat:43.648553,lng:-79.402584},title:"Theatre Passe Muraille",website:"http://passemuraille.ca/current-season",blurb:"Theatre Passe Muraille (TPM) believes there should be a more diverse representation of artists, audience members, and stories in our theatre in Canada. TPM aspires to be a leader locally, nationally and internationally in establishing, promoting, and embracing collaborative and inclusive theatre practices that support and ignite the voices of unique artists, communities and audiences."},{twitter:"FactoryToronto",position:{lat:43.645531,lng:-79.40269},title:"Factory Theatre",website:"https://www.factorytheatre.ca/what-s-on/",blurb:"From its founding in 1970 with a commitment to Canadian stories; to the Heritage building that now houses the 45-year old company; Factory's vision has always conveyed indomitable courage and resolve; toughness; tenaciousness; and strength of character. Factory has grit."},{twitter:"StorefrontTO",position:{lat:43.661288,lng:-79.42824},title:"Storefront Theatre",website:"http://thestorefronttheatre.com/current-season/",blurb:"The Storefront Arts Initiative represents the Storefront Theatre’s management team and its commitment to the artistic independent scene in Toronto through affordable venues, groundbreaking productions, collaborative discourse and community-centric support."},{twitter:"NativeEarth",position:{lat:43.659961,lng:-79.362607},title:"Native Earth Performing Arts",website:"http://www.nativeearth.ca/aki-studio-theatre/",blurb:"Through stage productions (theatre, dance and multi-disciplinary art), new script development, apprenticeships and internships, Native Earth seeks to fulfill a community of artistic visions. It is a vision that is inclusive and reflective of the artistic directions of members of the Indigenous community who actively participate in the arts."},{twitter:"canadianstage",title:"Berkeley Street Theatre",website:"https://nowtoronto.com/locations/berkeley-street-theatre/",blurb:"Berkeley Street Theatre is associated with the Canadian Stage Company. <br>A home for innovative live performance from Canada and around the world,<br>Where audiences encounter daring productions, guided by a strong directorial vision <br>Where theatre, dance, music and visual arts cohabit, clash, interrogate <br>Where a bold, 21st-century aesthetic reigns",address:"26 Berkeley St, Toronto",position:{lat:43.650621,lng:-79.363817}},{twitter:"canadianstage",title:"Bluma Appel Theatre",content:"Bluma Appel Theatre",website:"https://www.canadianstage.com/Online/default.asp",blurb:"Bluma Appel Theatre is associated with the Canadian Stage Company. <br>A home for innovative live performance from Canada and around the world,<br>Where audiences encounter daring productions, guided by a strong directorial vision <br>Where theatre, dance, music and visual arts cohabit, clash, interrogate <br>Where a bold, 21st-century aesthetic reigns",address:"27 Front St E, Toronto",position:{lat:43.647414,lng:-79.375129}},{twitter:"Soulpepper",title:"Soulpepper Theatre Company",website:"https://www.soulpepper.ca/performances.aspx",blurb:"Central to Soulpepper’s identity is its commitment to being a Civic Theatre - a place of belonging for artists and audiences of all ages and backgrounds. We are the largest employer of theatre artists in Toronto, and our artists live and play in this community. Our partners are our neighbours and the stories we tell are infused with our shared experiences. Soulpepper plays an intrinsic role in the cultural life of this city.",address:"50 Tank House Lane, Toronto",position:{lat:43.65086,lng:-79.357452}}]}};mapManager.load();var mapManager=mapManager||{};mapManager.util=mapManager.util||{},mapManager.util.blankInfoWin={content:"",maxWidth:200},mapManager.util.nullPosition={lat:0,lng:0};