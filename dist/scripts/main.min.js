var google=google||{},mapManager=mapManager||{},ko=ko||{},TheatreMapViewModel=TheatreMapViewModel||{},mapManager=function(e,t,i,o){"use strict";return e.initMap=function(){var t={lat:43.657899,lng:-79.3782433};e.directionsService=new o.maps.DirectionsService,e.util.windowWidth=window.innerWidth,e.util.screenWidth=screen.width,e.map=new o.maps.Map(document.getElementById("map"),{center:t,scrollwheel:!0,zoom:12,disableDefaultUI:!0,styles:[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#46bcec"},{visibility:"on"}]}]}),e.geocoder=new o.maps.Geocoder,i.addMarkers()},e.pushMarker=function(i,r){r.push(new o.maps.Marker({position:e.util.nullPosition,map:e.map,title:i.title,twitterHandle:i.twitter,icon:i.icon,listed:t.observable(!0),founded:i.founded,flags:i.flags,blurb:"",address:i.address,animation:o.maps.Animation.DROP}))},e.adjustPosition=function(t,i){var o=i.position,r=i.address;o?t.setPosition(o):r?e.mapPositionAJAX(t,r):t.setMap(null)},e.setDescription=function(t,i,o,r){i&&o&&r?(t.website=o,t.blurb=r):i?e.markerDataAjax(t,o,r):(t.website=o,t.blurb=r)},e.markerDataAjax=function(e,t,i){var o=e.title.replace(/ /g,"_"),r="https://en.wikipedia.org/w/api.php?action=opensearch&format=json&search="+o+"&limit=1&redirects=resolve",n=setTimeout(function(){e.website=t,e.blurb=i},5e3);$.ajax({url:r,dataType:"jsonp",success:function(o){clearTimeout(n);var r,a,s=o[1].length;s?(r=t?t:o[3][0],a=i?i:o[2][0]):(r=t,a=i),e.website=r,e.blurb=a},error:function(o){console.log("Could not access Wikipedia API."),e.website=t,e.blurb=i}})},e.mapPositionAJAX=function(e,t){var i=t.replace(/ /g,"+"),r="https://maps.googleapis.com/maps/api/geocode/json?address="+i+"&bounds=43.573936,-79.560076|43.758672,-79.275135&key=AIzaSyA4SAawmy-oEMzdWboD0iHk9gDmmjb61o4";$.getJSON(r,function(t){var i=t.results[0].geometry.location.lat,r=t.results[0].geometry.location.lng;e.setPosition(new o.maps.LatLng(i,r))}).error(function(i){console.log("We experienced a failure when making the coordinate request for "+t+" for the place called "+e.title),e.setMap(null)})},e.load=function(){e.markerData=[{twitter:"yyzbuddies",title:"Buddies in Bad Times Theatre",website:"http://buddiesinbadtimes.com/events/",blurb:"Buddies in Bad Times Theatre creates vital Canadian theatre by developing and presenting voices that question sexual and cultural norms. Built on the political and social principles of queer liberation, Buddies supports artists and works that reflect and advance these values. As the world’s longest-running and largest queer theatre, Buddies is uniquely positioned to develop, promote, and preserve stories and perspectives that are challenging and alternative.",address:"12 Alexander St, Toronto, ON M4Y 1B4",position:{lat:43.663346,lng:-79.383107},icon:"dist/images/museum.png",flags:["Queer culture","Alternative","Community focused","Theatre venue"],founded:1978},{twitter:"tarragontheatre",title:"Tarragon Theatre",website:"http://tarragontheatre.com/now-playing/",blurb:"Tarragon Theatre’s mission is to create, develop and produce new plays and to provide the conditions for new work to thrive. To that end, the theatre engages the best theatre artists and craftspeople to interpret new work; presents each new work with high quality production values; provides an administrative structure to support new work; develops marketing strategies to promote new work; and continually generates an audience for new work.",address:"30 Bridgman Ave, Toronto, ON M5R 1X3",position:{lat:43.674842,lng:-79.41282},icon:"dist/images/museum.png",flags:["Theatre venue"],founded:1970},{twitter:"beyondwallsTPM",title:"Theatre Passe Muraille",website:"http://passemuraille.ca/current-season",blurb:"Theatre Passe Muraille (TPM) believes there should be a more diverse representation of artists, audience members, and stories in our theatre in Canada. TPM aspires to be a leader locally, nationally and internationally in establishing, promoting, and embracing collaborative and inclusive theatre practices that support and ignite the voices of unique artists, communities and audiences.",address:"16 Ryerson Ave, Toronto, ON M5T 2P3",position:{lat:43.648553,lng:-79.402584},icon:"dist/images/museum.png",flags:["Diversity","Theatre venue"],founded:1968},{twitter:"FactoryToronto",title:"Factory Theatre",website:"https://www.factorytheatre.ca/what-s-on/",blurb:"From its founding in 1970 with a commitment to Canadian stories; to the Heritage building that now houses the 45-year old company; Factory's vision has always conveyed indomitable courage and resolve; toughness; tenaciousness; and strength of character. Factory has grit.",address:"125 Bathurst St, Toronto, ON M5V 2R2",position:{lat:43.645531,lng:-79.40269},icon:"dist/images/museum.png",flags:["Theatre venue"],founded:1970},{twitter:"StorefrontTO",title:"Storefront Theatre",website:"http://thestorefronttheatre.com/current-season/",blurb:"The Storefront Arts Initiative represents the Storefront Theatre’s management team and its commitment to the artistic independent scene in Toronto through affordable venues, groundbreaking productions, collaborative discourse and community-centric support.",address:"955 Bloor Street West, Toronto, ON M6H 1L7",position:{lat:43.661288,lng:-79.42824},icon:"dist/images/museum.png",flags:["Theatre venue"],founded:2013},{twitter:"NativeEarth",title:"Native Earth Performing Arts",website:"http://www.nativeearth.ca/aki-studio-theatre/",blurb:"Through stage productions (theatre, dance and multi-disciplinary art), new script development, apprenticeships and internships, Native Earth seeks to fulfill a community of artistic visions. It is a vision that is inclusive and reflective of the artistic directions of members of the Indigenous community who actively participate in the arts.",address:"585 Dundas St E #250, Toronto, ON M5A 2B7",position:{lat:43.659961,lng:-79.362607},icon:"dist/images/museum.png",flags:["Aboriginal","Community focused","Theatre venue"],founded:1982},{twitter:"canadianstage",title:"Berkeley Street Theatre",website:"https://nowtoronto.com/locations/berkeley-street-theatre/",blurb:"Berkeley Street Theatre is associated with the Canadian Stage Company.  A home for innovative live performance from Canada and around the world, Where audiences encounter daring productions, guided by a strong directorial vision Where theatre, dance, music and visual arts cohabit, clash, interrogate Where a bold, 21st-century aesthetic reigns",address:"26 Berkeley St, Toronto",position:{lat:43.650621,lng:-79.363817},icon:"dist/images/museum.png",flags:["Theatre venue"],founded:1987},{twitter:"canadianstage",title:"Bluma Appel Theatre",content:"Bluma Appel Theatre",website:"https://www.canadianstage.com/Online/default.asp",blurb:"Bluma Appel Theatre is associated with the Canadian Stage Company. A home for innovative live performance from Canada and around the world, Where audiences encounter daring productions, guided by a strong directorial vision Where theatre, dance, music and visual arts cohabit, clash, interrogate Where a bold, 21st-century aesthetic reigns",address:"27 Front St E, Toronto",position:{lat:43.647414,lng:-79.375129},icon:"dist/images/museum.png",flags:["International","Theatre venue"],founded:1987},{twitter:"Soulpepper",title:"Soulpepper Theatre Company",website:"https://www.soulpepper.ca/performances.aspx",blurb:"Central to Soulpepper’s identity is its commitment to being a Civic Theatre - a place of belonging for artists and audiences of all ages and backgrounds. We are the largest employer of theatre artists in Toronto, and our artists live and play in this community. Our partners are our neighbours and the stories we tell are infused with our shared experiences. Soulpepper plays an intrinsic role in the cultural life of this city.",address:"50 Tank House Lane, Toronto",position:{lat:43.65086,lng:-79.357452},icon:"dist/images/museum.png",flags:["Community focused","Theatre venue"],founded:1998},{twitter:"fuGENTheatre",title:"fu-GEN Theatre",website:"http://fu-gen.org/current-season/",blurb:"fu-GEN is a charitable theatre company dedicated to the development of professional Asian Canadian theatre artists through the production of new and established works.",address:"157 Carlton St #207, Toronto",position:{lat:43.663233,lng:-79.372377},icon:"dist/images/city.png",flags:["Asian-Canadian","Company office"],founded:2002},{twitter:"CahootsTheatre",title:"Cahoots Theatre Company",website:"http://www.cahoots.ca/",blurb:"Cahoots Theatre investigates and examines thecomplexities of diversity through the creation and production of new theatre works, development of professional artists and the engagement of communities.",address:"388 Queen Street East, Unit 3, Toronto, Ontario M5A 1T3",position:{lat:43.656172,lng:-79.363262},icon:"dist/images/city.png",flags:["Diversity","Community focused","Company office"],founded:1986},{twitter:"bcurrentLIVE",title:"b current",website:"http://bcurrent.ca/events/",blurb:"b current is the hotbed for culturally-rooted theatre development in Toronto. Originally founded as a place for black artists to create, nurture, and present their new works, our company has grown to support artists from all diasporas. We strived over two decades to create space for diverse voices to be heard, always with a focus on engaging the communities from which our stories emerge.",address:"601 Christie St #251, Toronto, ON M6G 4C7",position:{lat:43.680006,lng:-79.4237},icon:"dist/images/city.png",flags:["Diversity","Company office"],founded:1991},{twitter:"Videofag",title:"videofag",website:"http://www.videofag.com/#!events/ckiy",blurb:"videofag is a storefront cinema and performance lab in toronto's kensington market dedicated to the creation and exhibition of video, film, new media, and live art.",address:"187 Augusta Avenue, Toronto, Ontario, M5T 2L4",position:{lat:43.653486,lng:-79.401357},icon:"dist/images/museum.png",flags:["Alternative","Theatre venue"],founded:2012},{twitter:"YPTToronto",title:"Young People's Theatre",website:"http://www.youngpeoplestheatre.ca/shows-tickets/",blurb:"From the very beginning, Young Peoples Theatre established its dedication to professional productions of the highest quality – classic or contemporary – from Canada and around the world, written just for children and the people who care about them.",address:"165 Front St E, Toronto, ON M5A 3Z4, Canada",position:{lat:43.650022,lng:-79.368883},icon:"dist/images/museum.png",flags:["Theatre for children","Theatre venue"],founded:1966},{twitter:"TheatreDirectCa",title:"Theatre Direct",website:"http://theatredirect.ca/productions/",blurb:"Our work is driven by a belief that young people deserve truth not diversion – that they have a right to meaningful cultural content and experiences. We view our audience as thinking, feeling, complex individuals – not a market and not future audiences, but our present audience of emerging citizens that demands relevant theatre that engages all their faculties, feelings and intellect.",address:"601 Christie St, Toronto, ON M6G 4C7",position:{lat:43.679979,lng:-79.424069},icon:"dist/images/city.png",flags:["Theatre for children","Company office"],founded:1976},{twitter:"AlunaTheatre",title:"Aluna Theatre",website:"http://www.alunatheatre.ca/current-productions/",blurb:"The artistic mission of Aluna Theatre is to embrace the myriad of voices, cultures, and stories of our population, which are transforming the landscape of Canadian theatre. In our plays, works in translation, and international co-creations, people are complex individuals who exist beyond the restrictions of cultural labels.",address:"1 Wiltshire Ave #124, Toronto, ON M6N 2V7",position:{lat:43.667751,lng:-79.449632},icon:"dist/images/city.png",flags:["Diversity","Women","Latin-Canadian","Company office"],founded:2001},{twitter:"TGargantua",title:"Theatre Gargantua",website:"http://theatregargantua.ca/productions/",blurb:"Each of Gargantua’s productions, while being diverse in terms of subject, writing and performance styles, melds daring physicality with striking designs, underpinned by original live music and the innovative use of technology.",address:"651 Dufferin St, Toronto, ON M6K 2B2",position:{lat:43.650239,lng:-79.431099},icon:"dist/images/city.png",flags:["Technology","Company office"],founded:1992},{twitter:"crowstheatre",title:"Crow's Theatre",website:"http://www.crowstheatre.com/production/in-development/",blurb:"Crow’s has a mission to ignite passionate and enduring engagement between our audiences and artists by creating, producing and promoting unforgettable theatre that examines and illuminates the pivotal narratives of our times.",address:"696 Queen St E #2C, Toronto, ON M4M 1G9",position:{lat:43.659415,lng:-79.350262},icon:"dist/images/museum.png",flags:["Theatre venue"],founded:1983},{twitter:"nightwoodtheat",title:"Nightwood Theatre",website:"http://www.nightwoodtheatre.net/index.php/whats_on",blurb:"Nightwood Theatre forges creative alliances among women artists from diverse backgrounds in order to develop and produce innovative Canadian Theatre. We produce original Canadian plays and works from the contemporary international repertoire.",address:"15 Case Goods Lane #306, Toronto, ON M5A 3C4",position:{lat:43.649895,lng:-79.358575},icon:"dist/images/city.png",flags:["Women","Diversity","Company office"],founded:1979},{twitter:"obsidiantheatre",title:"Obsidian Theatre Company",website:"http://www.obsidiantheatre.com/",blurb:"Obsidian is Canada’s leading culturally diverse theatre company. Our threefold mission is to produce plays, to develop playwrights and to train emerging theatre professionals. Obsidian is passionately dedicated to the exploration, development, and production of the Black voice.",address:"1089 Dundas St E, Toronto, ON M4M 1R9",position:{lat:43.663814,lng:-79.343623},icon:"dist/images/city.png",flags:["Black","Diversity","Company office"],founded:2e3},{twitter:"TheBoxToronto",title:"The Box Toronto",website:"http://www.theboxtoronto.com//",blurb:"To fill the need in Toronto for affordable, accessible, clean rehearsal, studio and performance space and to help nurture and support theatre from the beginning stages of the artistic process to polished performance and everything inbetween.",address:"103-89 Niagara St, Toronto, On",position:{lat:43.641601,lng:-79.403273},icon:"dist/images/museum.png",flags:["Theatre venue"],founded:2013}]},e}(mapManager||{},ko,TheatreMapViewModel,google);mapManager.load();var mapManager=mapManager||{};mapManager.util=function(e){"use strict";var t={blankInfoWin:{content:"",maxWidth:240},nullPosition:{lat:0,lng:0},hideItem:function(e){e.setMap(null),e.listed(!1)},showItem:function(t){t.setMap(e.map),t.listed(!0)},alphabeticalSort:function(e,t){return e.title===t.title?0:e.title.toLowerCase()>t.title.toLowerCase()?1:-1},foundingSort:function(e,t){return e.founded===t.founded?0:e.founded>t.founded?1:-1},repositionTabs:function(){console.log("Resizing tabs");var e=$(".tab-image"),t=$(".twitter-tab-image"),i=$(".list-tab-image"),o=$(".filter-tab-image"),r=window.innerHeight,n=450>r?450:r;e.css("height",n/4.5),i.css({top:.05*r}),t.css({top:.35*r}),o.css({top:.65*r})}};return t}(mapManager),mapManager.util.repositionTabs();var mapManager=mapManager||{},ko=ko||{},TheatreMapViewModel=function(e,t,i){"use strict";return e.$rightDivWrapper=$("#right-divs-wrapper"),e.listIsOpen=t.observable(!1),e.filterIsOpen=t.observable(!1),e.leftDivOpen=t.observable(!1),e.twitterIsOpen=t.observable(!1),e.$divList=$("#list-div"),e.$tabHLList=$("#list-tab-highlight"),e.$tabBackList=$("#list-tab-back"),e.$tabAllList=$(".list-tab-image"),e.$divFilter=$("#filter-div"),e.$tabHLFilter=$("#filter-tab-highlight"),e.$tabBackFilter=$("#filter-tab-back"),e.$tabAllFilter=$(".filter-tab-image"),e.$divTwitter=$("#twitter-div"),e.$tabHLTwitter=$("#twitter-tab-highlight"),e.$tabBackTwitter=$("#twitter-tab-back"),e.$tabAllTwitter=$(".twitter-tab-image"),e.$divDisplay=$("#display-div"),e.$directionsButton=$("#direction-button"),e.showDirections=t.observable(!1),e.$leftDivOpener=$("#left-div-open-button"),e.$creditDiv=$("#credit-div"),e.creditOn=t.observable(!1),e.$overlayScreen=$("#overlay-screen"),e.$buttonOverlay=$(".button-overlay"),e.$titleOverlay=$(".title-background"),e.$rightOverlay=$(".right-overlay"),e.$titleToronto=$(".title-toronto"),e.$titleText=$(".title-text"),e.$loadButton=$("#load-button"),e.$loadMover=$("#load-mover"),e.$creditMarker=$("#credit-marker"),e.closeLeftDiv=function(){e.$divDisplay.addClass("left-div-off"),e.$divDisplay.removeClass("left-div-on"),e.leftDivOpen(!1)},e.closeMarkerInfo=function(){e.closeDirections(),e.closeLeftDiv(),e.closeInfoWindow(),e.closeRightDivs(),e.closeCredits()},e.openInfoWindow=function(t){e.infoWindow.open(i.map,t),i.map.panBy(0,-160)},e.closeInfoWindow=function(){e.infoWindow.close()},e.slideCredits=function(){e.creditOn(!e.creditOn())},e.closeCredits=function(){e.creditOn()&&e.creditOn(!1)},e.hideCredits=t.computed(function(){e.listIsOpen()||e.filterIsOpen()||e.twitterIsOpen()?e.$creditMarker.addClass("hide-credit"):e.$creditMarker.removeClass("hide-credit")}),e.fadeDisplayDivButton=t.computed(function(){e.leftDivOpen()?e.$leftDivOpener.addClass("button-disabled"):e.$leftDivOpener.removeClass("button-disabled")}),e.detailText=t.computed(function(){return e.showDirections()?"Direction Steps":"Get Details"}),e}(TheatreMapViewModel||{},ko,mapManager),ko=ko||{},TheatreMapViewModel=function(e,t){"use strict";return e.glowingTwitter=!1,e.glowingList=!1,e.glowingFilter=!1,e.glowingTwitterFading=!1,e.glowingListFading=!1,e.glowingFilterFading=!1,e.glowingTwitterOpacity=0,e.glowingListOpacity=0,e.glowingFilterOpacity=0,e.glowAnimation=function(){e.twitterIsOpen()&&e.glowingTwitter&&(e.glowingTwitter=!1,e.stopGlow()),e.listIsOpen()&&e.glowingList&&e.stopGlow(),e.filterIsOpen()&&e.glowingFilter&&e.stopGlow(),e.glowingTwitter&&e.animateGlowTab("Twitter"),e.glowingList&&!e.listIsOpen()&&e.animateGlowTab("List"),e.glowingFilter&&!e.filterIsOpen()&&e.animateGlowTab("Filter"),window.requestAnimationFrame(e.glowAnimation)},e.animateGlowTab=function(t){e["glowing"+t+"Fading"]?(e["glowing"+t+"Opacity"]-=.01,e["$tabHL"+t].css("opacity",e["glowing"+t+"Opacity"]),e["glowing"+t+"Opacity"]<=0&&(e["glowing"+t+"Fading"]=!1)):(e["glowing"+t+"Opacity"]+=.01,e["$tabHL"+t].css("opacity",e["glowing"+t+"Opacity"]),e["glowing"+t+"Opacity"]>=1.3&&(e["glowing"+t+"Fading"]=!0))},e.stopGlow=function(){e.glowingTwitter||(e.glowingTwitterFading=!1,e.$tabHLTwitter.css("opacity",0),e.glowingTwitterOpacity=0),e.glowingList||(e.glowingTwitterFading=!1,e.$tabHLList.css("opacity",0),e.glowingTwitterOpacity=0),e.filterIsOpen()&&(e.glowingTwitterFading=!1,e.$tabHLFilter.css("opacity",0),e.glowingTwitterOpacity=0)},e}(TheatreMapViewModel||{},ko),ko=ko||{},mapManager=mapManager||{},google=google||{},TheatreMapViewModel=function(e,t,i,o){"use strict";return e.markers=t.observableArray([]),e.currentTitle=t.observable(""),e.currentWebsite=t.observable(""),e.currentBlurb=t.observable(""),e.currentAddress=t.observable(""),e.currentDirections=t.observableArray([]),e.currentCopyrights=t.observable(""),e.currentPosition=t.observable({}),e.currentTravelDuration=t.observable(0),e.directionSuccess=t.observable(!1),e.infoWindow={},e.closeRightDivs=function(){e.listIsOpen()&&e.slideList(),e.twitterIsOpen()&&e.slideTwitter(),e.filterIsOpen()&&e.slideFilter()},e.openLeftDiv=function(){e.leftDivOpen(!0),e.$divDisplay.addClass("left-div-on"),e.$divDisplay.removeClass("left-div-off"),i.util.windowWidth<1040&&e.closeRightDivs()},e.slideHelper=function(t,i){var o=t.toLowerCase();"off"===i?(e.$rightDivWrapper.addClass("wrapper-off"),e[o+"IsOpen"](!1),e["$div"+t].addClass("right-div-off"),e["$tabAll"+t].addClass("tab-off"),e["$div"+t].removeClass("right-div-on"),e["$tabAll"+t].removeClass("tab-on"),e["$tabBack"+t].css("opacity",0)):"on"===i?(e.$rightDivWrapper.removeClass("wrapper-off"),e[o+"IsOpen"](!0),e.determineNeedToReload(),e["$div"+t].addClass("right-div-on"),e["$tabAll"+t].addClass("tab-on"),e["$div"+t].removeClass("right-div-off"),e["$tabAll"+t].removeClass("tab-off"),e["$tabBack"+t].css("opacity",1)):console.log("Invalid direction"+i+"passed to slideHelper")},e.slideList=function(){e.listIsOpen()?e.slideHelper("List","off"):(e.glowingList&&(e.glowingList=!1,e.stopGlow()),e.slideHelper("List","on"))},e.slideFilter=function(){e.filterIsOpen()?e.slideHelper("Filter","off"):e.slideHelper("Filter","on")},e.slideTwitter=function(){e.twitterIsOpen()?e.slideHelper("Twitter","off"):e.slideHelper("Twitter","on")},e.userTwitter=function(){e.twitterListView(!1)},e.determineNeedToReload=function(){var t=e.currentTwitterUserLong,i=e.currentTwitterListLong,o=e.twitterLong();e.needTwitterUserReload(t&&!o||!t&&o),e.needTwitterListReload(i&&!o||!i&&o),(e.needTwitterUserReload()||e.needTwitterListReload())&&(e.glowingTwitter=!0)},e.accessMarker=function(t){e.listIsOpen()&&i.util.windowWidth<1040&&e.slideList(),e.currentTitle(t.title),e.currentWebsite(t.website),e.currentBlurb(t.blurb),e.currentAddress(t.address),e.currentPosition(t.position),e.infoWindow.setContent(e.currentInfo()),i.map.panTo(t.getPosition()),e.openInfoWindow(t),e.moveButton(),e.showDirections()&&e.closeDirections(),e.bounceMarker(t),e.openLeftDiv(),e.activeTwitter(t.twitterHandle),e.userTwitter(),e.determineNeedToReload()},e.bounceMarker=function(e){var t=e.getPosition();e.setDraggable(!0),e.setAnimation(o.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},50),setTimeout(function(){e.setDraggable(!1),e.setPosition(t)},1e3)},e.infoWindowBinder=function(t){t.addListener("click",function(){e.accessMarker(t)})},e.addMarkers=function(){i.markerData.forEach(function(t,o){i.pushMarker(t,e.markers);var r=e.markers()[o];i.adjustPosition(r,t),e.infoWindowBinder(r);var n=t.title,a=t.website,s=t.blurb;i.setDescription(r,n,a,s)}),e.sortListAlpha(),e.infoWindow=new o.maps.InfoWindow(i.util.blankInfoWin),e.glowingList=!1,e.pickRandomTheatre(),window.requestAnimationFrame(e.glowAnimation)},e.currentInfo=t.computed(function(){var t='<div id="opened-info-window" class="opened-info-window"><span class="info-title">'+e.currentTitle()+"</span><br>"+e.currentAddress()+"<br></div>";return t}),e.pickRandomTheatre=function(){var t=e.markers().length,i=Math.floor(Math.random()*t);e.activeTwitter(e.markers()[i].twitterHandle),e.currentTitle(e.markers()[i].title),e.glowingTwitter=!1,e.stopGlow()},e}(TheatreMapViewModel||{},ko,mapManager,google),mapManager=mapManager||{},google=google||{},ko=ko||{},prompt=prompt||function(){},TheatreMapViewModel=function(e,t,i,o){"use strict";return e.startingLocation=t.observable("Yonge and Bloor"),e.locationRequested=t.observable(!1),e.addressToDisplay=t.observable("Yonge and Bloor"),e.directionsReady=t.observable(!1),e.directionOption=t.observable(!1),e.directionInputDisplay=t.observable(!1),e.pendingAddress=t.observable(""),e.directionsPrompt=t.observable(""),e.directionQuestionGeolocation=t.observable(!1),e.directionQuestionDoubleCheck=t.observable(!1),e.directionQuestionTypeLocation=t.observable(!1),e.directionQuestionNewLocation=t.observable(!1),e.directionYesText=t.observable(""),e.directionNoText=t.observable(""),e.enterAddress=function(){e.startingLocation(e.pendingAddress()),e.addressToDisplay(e.pendingAddress()),e.pendingAddress(""),e.directionInputDisplay(!1),e.calcRoute(e.currentPosition())},e.newStartingLocation=function(){e.directionsReady(!1),e.directionOption(!0),e.directionsPrompt("Do you want to pick a new starting location for directions?"),e.nextQuestion(!0,"NewLocation")},e.calcRoute=function(t){e.locationRequested(!0);var r={origin:e.startingLocation(),destination:t,travelMode:o.maps.TravelMode.TRANSIT};e.currentDirections.removeAll(),e.currentTravelDuration(0),e.directionSuccess(!1),i.directionsService.route(r,function(t,r){if(r===o.maps.DirectionsStatus.OK){e.directionSuccess(!0);var n=/<[^>]*>/g,a=/Destination/g;i.directionsDisplay.setDirections(t);var s=!0;t.routes[0].legs[0].steps.forEach(function(t,i,o){s=!1,e.directionsReady(!0),e.currentDirections.push(t.instructions+" - "+t.distance.text+" ("+t.duration.text+")"),e.currentTravelDuration(e.currentTravelDuration()+parseInt(t.duration.text)),t.steps&&t.steps.forEach(function(t,i,o){if(t.instructions){var r=t.instructions.replace(n," "),s=r.replace(a,"-> Destination");e.currentDirections.push(s)}})}),e.currentCopyrights(t.routes[0].copyrights),s?(e.directionsPrompt("Please try a more specific address."),e.calcRouteFailed()):e.directionsReady(!0)}else e.directionsPrompt("Please try a more specific address. Though it is also possible that there is a network problem."),e.calcRouteFailed()})},e.calcRouteFailed=function(){console.log("There was some issue finding directions using the direction services on the Google Maps API"),e.directionsReady(!1),e.directionInputDisplay(!0)},e.travelTime=t.computed(function(){if(0===e.currentTravelDuration())return"Loading directions from Google Maps. If this message persists, there might be a connection problem :(";var t=1===e.currentTravelDuration()?".":"s.",i="This route will take approximately "+e.currentTravelDuration().toString()+" minute"+t;return i}),e.toggleDirections=function(t){e.showDirections(!e.showDirections()),e.showDirections()?("infoWin"===t&&e.locationRequested()&&(e.closeLeftDiv(),e.closeRightDivs()),e.locationRequested()||e.leftDivOpen()||e.openLeftDiv(),e.openDirections()):e.closeDirections()},e.toggleDirectionsDisplay=function(){e.toggleDirections()},e.toggleDirectionsInfo=function(){e.toggleDirections("infoWin")},e.openDirections=function(){e.$divDisplay.addClass("direction-extention"),i.directionsDisplay=new o.maps.DirectionsRenderer,i.directionsDisplay.setMap(i.map),e.locationRequested()?e.calcRoute(e.currentPosition()):(e.directionsPrompt("Share your location to find directions?"),e.nextQuestion(!0,"Geolocation"))},e.nextQuestion=function(t,i){e.directionQuestionNewLocation(!1),e.directionQuestionGeolocation(!1),e.directionQuestionDoubleCheck(!1),e.directionQuestionTypeLocation(!1),t?(e.directionOption(!0),e["directionQuestion"+i](!0),e.changeButtonText()):e.directionOption(!1)},e.changeButtonText=function(){e.directionQuestionNewLocation()?(e.directionYesText("Edit"),e.directionNoText("Cancel")):e.directionQuestionGeolocation()?(e.directionYesText("Allow"),e.directionNoText("Deny")):e.directionQuestionDoubleCheck()?(e.directionYesText("Close Enough!"),e.directionNoText("Way off!")):e.directionQuestionTypeLocation()?(e.directionYesText("Edit"),e.directionNoText("Too lazy")):(e.directionYesText("Yes"),e.directionNoText("No"))},e.directionsYes=function(){e.directionQuestionGeolocation()?e.getLocation():e.directionQuestionDoubleCheck()?(e.nextQuestion(!1,""),e.calcRoute(e.currentPosition())):e.directionQuestionTypeLocation()?(e.nextQuestion(!1,""),e.directionsPrompt("Please enter a specific address."),e.directionInputDisplay(!0)):e.directionQuestionNewLocation()?(e.locationRequested(!1),i.directionsDisplay.setMap(null),e.openDirections()):console.log("Invalid situation to press yes button!")},e.directionsNo=function(){e.directionQuestionGeolocation()?(e.directionsPrompt("Want to enter the location you want to travel from yourself?"),e.nextQuestion(!0,"TypeLocation")):e.directionQuestionDoubleCheck()?(e.directionsPrompt("Sorry about that. Want to enter the location you want to travel from yourself?"),e.nextQuestion(!0,"TypeLocation")):e.directionQuestionTypeLocation()?"your location"===e.addressToDisplay()?(e.nextQuestion(!1,""),e.calcRoute(e.currentPosition())):(e.nextQuestion(!1,""),e.startingLocation("Yonge and Bloor"),e.addressToDisplay("Yonge and Bloor"),e.calcRoute(e.currentPosition())):e.directionQuestionNewLocation()?(e.directionsReady(!0),e.directionOption(!1)):console.log("Invalid situation to press no button!")},e.getLocation=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var i=t.coords.latitude,o=t.coords.longitude;e.startingLocation({lat:i,lng:o}),e.addressAJAX(i,o)},function(){console.log("No permission to get geolocation of user!"),e.directionsPrompt("We're struggling to find an address corresponding to your coordinates. Would you like to enter the address you want directions from instead?"),e.nextQuestion(!0,"TypeLocation")}):(console.log("Geolocation can't be used in this browser!"),e.directionsPrompt("We're struggling to find an address corresponding to your coordinates. Would you like to enter the address you want directions from instead?"),e.nextQuestion(!0,"TypeLocation"))},e.addressAJAX=function(t,i){var o="https://maps.googleapis.com/maps/api/geocode/json?latlng="+t+","+i+"&key=AIzaSyA4SAawmy-oEMzdWboD0iHk9gDmmjb61o4";$.ajax({url:o,success:function(t){t.results[0].formatted_address?(e.addressToDisplay(t.results[0].formatted_address),e.directionsPrompt("Are you travelling from "+t.results[0].formatted_address+"?"),e.nextQuestion(!0,"DoubleCheck")):(console.log("Could not generate human-readable address."),e.handleDirectionAJAXFailure())},error:function(t){console.log("Could not access reverse geocoding Google Maps API."),e.handleDirectionAJAXFailure()}})},e.handleDirectionAJAXFailure=function(){e.addressToDisplay("your location"),e.directionsPrompt("We're struggling to find an address corresponding to your coordinates. Would you like to enter your address instead?"),e.nextQuestion(!0,"TypeLocation")},e.directionText=t.computed(function(){return e.showDirections()?"Hide Directions":"Show Directions"}),e.closeDirections=function(){i.directionsDisplay&&i.directionsDisplay.setMap(null),e.directionInputDisplay(!1),e.showDirections(!1),e.$divDisplay.removeClass("direction-extention")},e.moveButton=function(){$("#opened-info-window").append(e.$directionsButton)},e}(TheatreMapViewModel||{},ko,mapManager,google),ko=ko||{},twttr=twttr||{},TheatreMapViewModel=function(e,t,i){"use strict";return e.activeTwitter=t.observable(""),e.lastTwitterUser=t.observable(""),e.currentTwitterListLong=!1,e.currentTwitterUserLong=!1,e.twitterLong=t.observable(!1),e.needTwitterUserReload=t.observable(!0),e.needTwitterListReload=t.observable(!0),e.$twitterErrorDiv=$("#twitter-error"),e.errorTimeoutRequest=null,e.twitterListView=t.observable(!0),e.$twitterListDiv=$("#twitter-list"),e.$twitterAccountDiv=$("#twitter-account"),e.firstListLoad=!0,e.blinkTwitterError=function(){e.errorTimeoutRequest&&clearTimeout(e.errorTimeoutRequest),e.$twitterErrorDiv.hide(),e.errorTimeoutRequest=setTimeout(function(){e.$twitterErrorDiv.show()},1500)},e.newTwitterUser=t.computed(function(){var t=e.activeTwitter()!==e.lastTwitterUser();return t&&(e.glowingTwitter=!0),t}),e.toggleTwitterLength=function(){e.blinkTwitterError(),e.twitterLong(!e.twitterLong()),e.twitterLong()?(e.$twitterListDiv.removeClass("scroll-div"),e.$twitterAccountDiv.removeClass("scroll-div")):(e.$twitterListDiv.addClass("scroll-div"),e.$twitterAccountDiv.addClass("scroll-div")),e.determineNeedToReload()},e.switchTwitter=function(){e.blinkTwitterError(),e.twitterListView(!e.twitterListView())},e.newTwitterUserFeed=t.computed(function(){e.twitterIsOpen()&&!e.twitterListView()&&(e.needTwitterUserReload()||e.newTwitterUser())&&(e.blinkTwitterError(),e.needTwitterUserReload(!1),e.lastTwitterUser(e.activeTwitter()),document.getElementById("twitter-account").innerHTML="",e.twitterLong()?(e.currentTwitterUserLong=!0,i.widgets.createTimeline("694221648225001472",document.getElementById("twitter-account"),{
screenName:e.activeTwitter(),height:window.innerHeight-105})):(e.currentTwitterUserLong=!1,i.widgets.createTimeline("694221648225001472",document.getElementById("twitter-account"),{screenName:e.activeTwitter(),tweetLimit:5})))}),e.newTwitterListFeed=t.computed(function(){e.twitterIsOpen()&&e.twitterListView()&&(e.firstListLoad||e.needTwitterListReload())&&(e.blinkTwitterError(),e.firstListLoad=!1,e.needTwitterListReload(!1),document.getElementById("twitter-list").innerHTML="",e.twitterLong()?(e.currentTwitterListLong=!0,i.widgets.createTimeline("694233158955323392",document.getElementById("twitter-list"),{listOwnerScreenName:"BreathMachine",listSlug:"toronto-theatre",height:window.innerHeight-70})):(e.currentTwitterListLong=!1,i.widgets.createTimeline("694233158955323392",document.getElementById("twitter-list"),{listOwnerScreenName:"BreathMachine",listSlug:"toronto-theatre",tweetLimit:10})))}),e}(TheatreMapViewModel||{},ko,twttr),ko=ko||{},mapManager=mapManager||{},TheatreMapViewModel=function(e,t,i){"use strict";return e.filterText=t.observable(""),e.filterDiverse=t.observable(!1),e.filterWomen=t.observable(!1),e.filterBlack=t.observable(!1),e.filterAboriginal=t.observable(!1),e.filterQueer=t.observable(!1),e.filterAsian=t.observable(!1),e.filterLatin=t.observable(!1),e.filterAlternative=t.observable(!1),e.filterCommunity=t.observable(!1),e.filterInternational=t.observable(!1),e.filterChildren=t.observable(!1),e.filterTechnology=t.observable(!1),e.filterOffice=t.observable(!1),e.filterVenue=t.observable(!1),e.filters=[{filter:e.filterDiverse,flag:"Diversity"},{filter:e.filterWomen,flag:"Women"},{filter:e.filterBlack,flag:"Black"},{filter:e.filterAboriginal,flag:"Aboriginal"},{filter:e.filterQueer,flag:"Queer culture"},{filter:e.filterAsian,flag:"Asian-Canadian"},{filter:e.filterLatin,flag:"Latin-Canadian"},{filter:e.filterAlternative,flag:"Alternative"},{filter:e.filterCommunity,flag:"Community focused"},{filter:e.filterInternational,flag:"International"},{filter:e.filterChildren,flag:"Theatre for children"},{filter:e.filterTechnology,flag:"Technology"},{filter:e.filterOffice,flag:"Company office"},{filter:e.filterVenue,flag:"Theatre venue"}],e.toggleFilter=function(e){e.filter(!e.filter())},e.filterClicked=t.computed(function(){var t,i=e.filters.length;for(t=0;i>t;t++)if(e.filters[t].filter())return void(e.glowingFilter=!0);e.glowingFilter=!1,e.stopGlow()}),e.clearFilters=function(){var t,i=e.filters.length;for(t=0;i>t;t++)e.filters[t].filter(!1)},e.filterMarkers=t.computed(function(){console.log("Running filter markers");var t,o,r,n=e.markers().length,a=e.filters.length,s=e.filterText().toLowerCase();for(""!==s?e.glowingList=!0:e.glowingList=!1,t=0;n>t;t++)if(r=e.markers()[t],i.util.showItem(r),""===s||!e.itemFailsTextFilter(r,s))for(o=0;a>o&&(!e.filters[o].filter()||!e.itemFailsFilter(r,e.filters[o].flag));o++);}),e.itemFailsTextFilter=function(e,t){return-1!==e.title.toLowerCase().search(t)?!1:(i.util.hideItem(e),!0)},e.itemFailsFilter=function(e,t){return-1!==$.inArray(t,e.flags)?!1:(i.util.hideItem(e),!0)},e}(TheatreMapViewModel||{},ko,mapManager),ko=ko||{},mapManager=mapManager||{},TheatreMapViewModel=function(e,t,i){"use strict";return e.sortedAlpha=!1,e.sortedFounded=!1,e.currentSort=t.observable(""),e.sortListAlpha=function(){e.resetSorts("sortedAlpha"),e.sortedAlpha?(e.sortedAlpha=!1,e.markers.reverse(),e.currentSort("alpha-reverse")):(e.sortedAlpha=!0,e.markers.sort(i.util.alphabeticalSort),e.currentSort("alpha"))},e.sortListFounding=function(){e.resetSorts("sortedFounded"),e.sortedFounded?(e.sortedFounded=!1,e.markers.reverse(),e.currentSort("date-reverse")):(e.sortedFounded=!0,e.markers.sort(i.util.foundingSort),e.currentSort("date"))},e.resetSorts=function(t){var i=e[t];e.sortedFounded=!1,e.sortedAlpha=!1,e[t]=i},e}(TheatreMapViewModel||{},ko,mapManager),TheatreMapViewModel=TheatreMapViewModel||{},ko=ko||{},mapManager=mapManager||{},googleWatcherObject=googleWatcherObject||{},TheatreMapViewModel=function(e,t,i,o){"use strict";return e.googleMapFailed=t.observable(!1),e.openOverlay=function(){e.$buttonOverlay.addClass("overlay-off"),e.$titleOverlay.addClass("overlay-off"),e.$rightOverlay.addClass("overlay-off"),e.$titleToronto.addClass("overlay-off"),e.$titleText.css("z-index",2),e.$overlayScreen.css("z-index",0),setTimeout(function(){e.slideList()},600),setTimeout(function(){e.$titleOverlay.remove(),e.$overlayScreen.remove(),e.$rightOverlay.remove(),e.$buttonOverlay.remove()},1400)},e.loadAnimation=function(){e.$loadMover.addClass("first-move"),setTimeout(function(){e.$loadMover.addClass("second-move"),setTimeout(function(){e.$loadMover.addClass("third-move"),setTimeout(function(){e.$loadMover.addClass("fourth-move"),e.$loadButton.addClass("fourth-move"),setTimeout(function(){e.$loadButton.remove()},1e3)},1e3)},1e3)},1e3)},e.launchAttempt=function(){"success"===o.googleWatcherVariable?i.initMap():"failure"===o.googleWatcherVariable?e.googleMapFailed(!0):setTimeout(function(){e.launchAttempt()},50)},e.setupToRun=function(){var t=$("#new-address-input");$("#list-filter-input");document.addEventListener("keyup",function(i){13===i.keyCode&&e.showDirections()&&!e.directionsReady()&&e.directionInputDisplay()&&t.is(":focus")&&e.enterAddress()}),$(window).load(function(){$("body").removeClass("preload")})},e}(TheatreMapViewModel||{},ko,mapManager,googleWatcherObject);TheatreMapViewModel.setupToRun(),TheatreMapViewModel.loadAnimation(),ko.applyBindings(TheatreMapViewModel),TheatreMapViewModel.launchAttempt();