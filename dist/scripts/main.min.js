var ko=ko||{},google=google||{},mapManager=mapManager||{},TheatreMapViewModel=function(){"use strict";var e=this;e.emailme="Please contant the developer at Andrei.Borissenko@gmail.com so that the issue can be promptly resolved.",e.searchText=ko.observable(""),e.markers=ko.observableArray([]),e.infoWindows=[],e.infoWindowsContent=ko.observableArray([]);var t,o=function(t,o){e.markers()[t].addListener("click",function(){e.infoWindows.forEach(function(e,t,o){e.close()}),o.open(mapManager.map,e.markers()[t]),console.log("Good job, you clicked on "+e.markers()[t].title)})};e.printSomething=function(){console.log(e.infoWindowsContent())},e.moveMarker=function(){e.infoWindows[0].open(mapManager.map,e.markers()[0])},e.addMarkers=function(){mapManager.markers.forEach(function(a,n,r){var i=!0;void 0===a.title&&(console.log("One of the inputted locations is not being displayed because it has no title attribute."),void 0!==a.content&&console.log("It has the following content attached to it: "+a.content),console.log(e.emailme),i=!1),void 0===a.position?(e.markers.push(new google.maps.Marker({position:mapManager.nullPosition,map:mapManager.map,title:a.title})),mapManager.coordinateRequest(a.address,e,n)):e.markers.push(new google.maps.Marker({position:a.position,map:mapManager.map,title:a.title})),i&&mapManager.wikipediaRequest(a.title,e,n),t=new google.maps.InfoWindow({content:"",maxWidth:150}),i||e.markers()[n].setMap(null),e.infoWindows.push(t),o(n,t)}),mapManager.store()}},tmvm=new TheatreMapViewModel;ko.applyBindings(tmvm);var google=google||{},tmvm=tmvm||{},mapManager={nullPosition:{lat:0,lng:0},initMap:function(){"use strict";var e={lat:43.657899,lng:-79.3782433};this.map=new google.maps.Map(document.getElementById("map"),{center:e,scrollwheel:!0,zoom:12,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_CENTER}}),tmvm.addMarkers()},wikipediaRequest:function(e,t,o){"use strict";var a=this,n=e.replace(/ /g,"_"),r="https://en.wikipedia.org/w/api.php?action=opensearch&format=json&search="+n+"&limit=1&redirects=resolve",i=setTimeout(function(){return t.infoWindows[o].setContent(a.markers[o].content),!1},5e3);$.ajax({url:r,dataType:"jsonp",success:function(e){clearTimeout(i);var n=e[1].length;if(n){var r='<h4><a href="'+e[3][0]+'">'+e[1][0]+"</a></h4><p>"+e[2][0]+"</p>";t.infoWindows[o].setContent(r)}1>n&&t.infoWindows[o].setContent(a.markers[o].content)}})},coordinateRequest:function(e,t,o){"use strict";var a=this,n=e.replace(/ /g,"+"),r="https://maps.googleapis.com/maps/api/geocode/json?address="+n+"&bounds=43.573936,-79.560076|43.758672,-79.275135&key=AIzaSyA4SAawmy-oEMzdWboD0iHk9gDmmjb61o4";$.getJSON(r,function(e){var n=e.results[0].geometry.location.lat,r=e.results[0].geometry.location.lng;t.markers()[o].setPosition(new google.maps.LatLng(n,r)),a.markers[o].position={lat:n,lng:r}}).error(function(n){console.log("We experienced a failure when making the coordinate request for "+e+" for the place called "+a.markers[o].title),t.markers()[o].setMap(null)})},store:function(){"use strict";localStorage.markers=JSON.stringify(this.markers)},load:function(){"use strict";localStorage.markers?this.markers=JSON.parse(localStorage.markers):this.markers=[{position:{lat:43.663346,lng:-79.383107},title:"Buddies in Bad Times Theatre",content:"Buddies in Bad Times Theatre."},{position:{lat:43.674842,lng:-79.41282},title:"Tarragon Theatre",content:"Tarragon Theatre"},{position:{lat:43.648553,lng:-79.402584},title:"Theatre Passe Muraille",content:"Theatre Passe Muraille"},{position:{lat:43.645531,lng:-79.40269},title:"Factory Theatre",content:"Factory Theatre"},{position:{lat:43.661288,lng:-79.42824},title:"Storefront Theatre",content:'<a href="http://thestorefronttheatre.com/">Storefront Theatre</a><p>Storefront Theatre is an independent theatre that is home of the Red One Theatre Collective.</p>'},{position:{lat:43.659961,lng:-79.362607},title:"Native Earth Performing Arts",content:'<a href="http://www.nativeearth.ca/">Native Earth Performing Arts</a><p>Founded in 1982, it is the oldest professional Aboriginal performing arts company in Canada.</p>'},{title:"Berkeley Street Theatre",content:"Berkeley Street Theatre",address:"26 Berkeley St, Toronto"},{title:"Bluma Appel Theatre",content:"Bluma Appel Theatre",address:"27 Front St E, Toronto"},{title:"Harbourfront Center",content:"Harbourfront Center",address:"235 Queens Quay W"}]}};mapManager.load();