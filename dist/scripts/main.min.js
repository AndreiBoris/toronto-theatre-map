var ko=ko||{},google=google||{},mapManager=mapManager||{},TheatreMapViewModel=function(){"use strict";var e=this;e.searchText=ko.observable(""),e.markers=[],e.infoWindowsContent=ko.observableArray([]);var t=function(t){e.markers[t].addListener("click",function(){e.openInfoWindow(t),console.log("Good job, you clicked on "+e.markers[t].title)})};e.openInfoWindow=function(t){e.markers.forEach(function(e,t,a){e.infoWin.close()}),e.markers[t].infoWin.open(mapManager.map,e.markers[t])},e.printSomething=function(){console.log(e.infoWindowsContent())},e.moveMarker=function(){e.openInfoWindow(0)},e.addMarkers=function(){var a;mapManager.markerData.forEach(function(o,n){var r=o.title?!0:!1;e.markers.push(new google.maps.Marker({position:mapManager.nullPosition,map:mapManager.map,title:o.title})),o.position?e.markers[n].setPosition(o.position):o.address?mapManager.coordinateRequest(o.address,e.markers,n):e.markers[n].setMap(null),a=new google.maps.InfoWindow({content:"",maxWidth:150}),e.markers[n].infoWin=a,t(n),r?mapManager.wikipediaRequest(o.title,e.markers,n):e.markers[n].infoWin.content=o.content}),mapManager.store()}},tmvm=new TheatreMapViewModel;ko.applyBindings(tmvm);var google=google||{},tmvm=tmvm||{},mapManager={nullPosition:{lat:0,lng:0},initMap:function(){"use strict";var e={lat:43.657899,lng:-79.3782433};this.map=new google.maps.Map(document.getElementById("map"),{center:e,scrollwheel:!0,zoom:12,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_CENTER}}),tmvm.addMarkers()},wikipediaRequest:function(e,t,a){"use strict";var o=this,n=e.replace(/ /g,"_"),r="https://en.wikipedia.org/w/api.php?action=opensearch&format=json&search="+n+"&limit=1&redirects=resolve",i=setTimeout(function(){t[a].infoWin.setContent(o.markerData[a].content)},5e3);$.ajax({url:r,dataType:"jsonp",success:function(e){console.log(e),clearTimeout(i);var n=e[1].length;if(n){var r='<h4><a href="'+e[3][0]+'">'+e[1][0]+"</a></h4><p>"+e[2][0]+"</p>";t[a].infoWin.setContent(r)}else t[a].infoWin.setContent(o.markerData[a].content)}})},coordinateRequest:function(e,t,a){"use strict";var o=this,n=e.replace(/ /g,"+"),r="https://maps.googleapis.com/maps/api/geocode/json?address="+n+"&bounds=43.573936,-79.560076|43.758672,-79.275135&key=AIzaSyA4SAawmy-oEMzdWboD0iHk9gDmmjb61o4";$.getJSON(r,function(e){var n=e.results[0].geometry.location.lat,r=e.results[0].geometry.location.lng;t[a].setPosition(new google.maps.LatLng(n,r)),o.markerData[a].position={lat:n,lng:r}}).error(function(n){console.log("We experienced a failure when making the coordinate request for "+e+" for the place called "+o.markerData[a].title),t[a].setMap(null)})},store:function(){"use strict";console.log("storing data"),localStorage.markerData=JSON.stringify(this.markerData)},load:function(){"use strict";console.log("loading data"),this.markerData=[{position:{lat:43.663346,lng:-79.383107},title:"Buddies in Bad Times Theatre",content:"Buddies in Bad Times Theatre."},{position:{lat:43.674842,lng:-79.41282},title:"Tarragon Theatre",content:"Tarragon Theatre"},{position:{lat:43.648553,lng:-79.402584},title:"Theatre Passe Muraille",content:"Theatre Passe Muraille"},{position:{lat:43.645531,lng:-79.40269},title:"Factory Theatre",content:"Factory Theatre"},{position:{lat:43.661288,lng:-79.42824},title:"Storefront Theatre",content:'<a href="http://thestorefronttheatre.com/">Storefront Theatre</a><p>Storefront Theatre is an independent theatre that is home of the Red One Theatre Collective.</p>'},{position:{lat:43.659961,lng:-79.362607},title:"Native Earth Performing Arts",content:'<a href="http://www.nativeearth.ca/">Native Earth Performing Arts</a><p>Founded in 1982, it is the oldest professional Aboriginal performing arts company in Canada.</p>'},{title:"Berkeley Street Theatre",content:"Berkeley Street Theatre",address:"26 Berkeley St, Toronto",position:{lat:43.650621,lng:-79.363817}},{title:"Bluma Appel Theatre",content:"Bluma Appel Theatre",address:"27 Front St E, Toronto",position:{lat:43.647414,lng:-79.375129}},{title:"Harbourfront Center",content:"Harbourfront Center",address:"235 Queens Quay W",position:{lat:43.638818,lng:-79.381911}},{title:"High Park Amphitheare",content:'<a href="https://www.canadianstage.com/Online/default.asp?BOparam::WScontent::loadArticle::permalink=1314shakespeare">Shakespeare in High Park</a><p>Each summer, a shakespeare show is performed at High Park Amphitheatre.</p>',position:{lat:43.646378,lng:-79.462464}},{title:"Royal Alexandra Theatre",content:'<a href="http://www.mirvish.com/theatres/royalalexandratheatre">Royal Alexandra Theatre</a><p>A venue ownedby Mirvish Productions with some of the highest production-value shows in the city.</p>',address:"260 King Street West, Toronto",position:{lat:43.647354,lng:-79.387593}},{title:"Soulpepper Theatre Company",content:'<a href="https://www.soulpepper.ca/">Soulpepper</a><p>Founded in 1998, this theatre company resides in the distillery district of Toronto.</p>',address:"50 Tank House Lane, Toronto",position:{lat:43.65086,lng:-79.357452}}]}};mapManager.load();var mapManager=mapManager||{};mapManager.utilities=mapManager.utilities||{},mapManager.utilities.emailMsg="Please contant the developer at Andrei.Borissenko@gmail.com so that the issue can be promptly resolved.";