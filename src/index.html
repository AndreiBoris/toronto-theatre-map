<!DOCTYPE html>
<html lang="en" id="html-elem">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta name="description" content="Theatre in Toronto">
    <meta name="author" content="Andrei Borissenko">
    <title>Toronto Live Theatre Resource</title>
    <!-- Twitter methods for creating timelines dynamically -->
    <script async src="https://platform.twitter.com/widgets.js"></script>
    <script>
    // Thank you to Jake Archibald at www.html5rocks.com for the following script!
    // http://www.html5rocks.com/en/tutorials/speed/script-loading/#disqus_thread
    // see dist/perm/production/jsLoading.js for details
    // Currently in DEVELOPMENT MODE
    'use strict';
    // If you add a script here, be sure to add it to the gulp file load order
    // as well in the Scripts task
    var scripts = [
        'dist/perm/production/jquery_and_knockout.min.js',
        'src/scripts/mapmanager.js', // development mode
        'src/scripts/utilities.js', // development mode
        'src/scripts/attributes.js', // development mode
        'src/scripts/directions.js', // development mode
        'src/scripts/markers.js', // development mode
        'src/scripts/twitter.js', // development mode
        'src/scripts/filter.js', // development mode
        'src/scripts/glow.js', // development mode
        'src/scripts/sort.js', // development mode
        'src/scripts/divs.js', // development mode
        'src/scripts/start.js', // development mode
        // 'dist/scripts/main.min.js', // PRODUCTION mode
        'https://maps.googleapis.com/maps/api/js?key=AIzaSyCQCl1KRNkAF-BPdyKyO92M0d4vd6MOd0w&callback=mapManager.initMap&region=CA'
    ];

    var src;
    var script;
    var pendingScripts = [];
    var firstScript = document.scripts[0];

    // Watch scripts load in IE
    function stateChange() {
        // Execute as many scripts in order as we can
        var pendingScript;
        while (pendingScripts[0] && pendingScripts[0].readyState === 'loaded') {
            pendingScript = pendingScripts.shift();
            // avoid future loading events from this script (eg, if src changes)
            pendingScript.onreadystatechange = null;
            // can't just appendChild, old IE bug if element isn't closed
            firstScript.parentNode.insertBefore(pendingScript, firstScript);
        }
    }

    // loop through our script urls
    while (scripts.length > 0) {
        src = scripts.shift();
        if ('async' in firstScript) { // modern browsers
            script = document.createElement('script');
            script.async = false;
            script.src = src;
            document.head.appendChild(script);
        } else if (firstScript.readyState) { // IE<10
            // create a script and add it to our todo pile
            script = document.createElement('script');
            pendingScripts.push(script);
            // listen for state changes
            script.onreadystatechange = stateChange;
            // must set src AFTER adding onreadystatechange listener
            // else weâ€™ll miss the loaded event for cached scripts
            script.src = src;
        } else { // fall back to defer
            document.write('<script src="' + src + '" defer></' + 'script>');
        }
    }
    </script>
    <link href="dist/styles/print.min.css" rel="stylesheet" media="print">
    <!-- All CSS styles for the page are here. -->
    <link href="dist/styles/main.min.css" rel="stylesheet">
</head>

<body id="body">
    <div id="display-div" class="left-divs left-div-off">
        <div id="display-box">
            <div class="current-display">
                <h4 class="display-title">
                <a class="display-link" target="_blank" data-bind="attr: { href: currentWebsite },
                text: currentTitle"></a>
                </h4>
                <div class="button-flex">
                    <div id="address-line" class="text-50" data-bind="text: currentAddress"></div>
                    <div href="" class="button-50-info button-blue text-center" data-bind="click: toggleDirectionsDisplay,
                    text: directionText">
                    </div>
                </div>
                <div data-bind="visible: !showDirections()">
                    <p data-bind="text: currentBlurb"></p>
                    <br>
                </div>
                <br>
                <div id="direction-button" class="button-flex">
                    <div id="left-div-open-button" href="" class="button-50-info button-black" data-bind="click: openLeftDiv,
                    text: detailText">
                    </div>
                    <div href="" class="button-50-info button-blue" data-bind="click: toggleDirectionsInfo,
                    text: directionText">
                    </div>
                </div>
                <div data-bind="visible: showDirections">
                    <ul class="directions" data-bind="foreach: currentDirections">
                        <li class="direction" data-bind="text: $data"></li>
                    </ul>
                    <br>
                    <p data-bind="text: travelTime"></p>
                    <br>
                    <p data-bind="text: currentCopyrights"></p>
                </div>
            </div>
        </div>
        <div class="button-flex">
            <div href="" class="button-50 button-black" data-bind="click: closeLeftDiv">
                Close Box
            </div>
            <div href="" class="button-50 button-teal" data-bind="click: closeMarkerInfo">
                Clear Map
            </div>
        </div>
    </div>
    <div id="map">
    </div>
    <!-- The following three images are all on top of one another and are revealed
        by changing the opacity through JavaScript. -->
    <img id="list-tab" class="tab-plain tab-off list-tab-image" src="dist/images/list-tab.png"></img>
    <img id="list-tab-highlight" class="tab-highlight tab-off list-tab-image" src="dist/images/list-tab-highlight.png"></img>
    <img id="list-tab-back" class="tab-back tab-off list-tab-image" data-bind="click: slideList" src="dist/images/tab-back.png"></img>
    <!-- This div lists all the theatres by name. -->
    <div id="list-div" class="right-divs right-div-off">
        <!-- These buttons allow sorting the theatres alphabetically or by date
            founded. -->
        <div class="button-flex">
            <div class="button-50 button-red" data-bind="click: sortListAlpha">
                Alphabetical
                <!-- The spans become visible when a sort method is selected 
                    and indicate which direction the sort is performed in using
                    up and down arrows. -->
                <span class="no-border" data-bind="visible: currentSort() === 'alpha'">&dArr;</span>
                <span class="no-border" data-bind="visible: currentSort() === 'alpha-reverse'">&uArr;</span>
            </div>
            <div class="button-50 button-green" data-bind="click: sortListFounding">
                Date Founded
                <span class="no-border" data-bind="visible: currentSort() === 'date'">&dArr;</span>
                <span class="no-border" data-bind="visible: currentSort() === 'date-reverse'">&uArr;</span>
            </div>
        </div>
        <!-- Use Knockout to list each item in the markers array. -->
        <ul class="button-list-flex scroll-div" data-bind="foreach: markers">
            <!-- Each item becomes a button that accesses the corresponding marker.
                A list item is 'visible' if it it not being filtered through the 
                controls in the filter-div below. -->
            <li class="button-list-item" data-bind="visible: listed, click: $root.accessMarker">
                <h4 class="bolded-text list-title" data-bind="text: title"></h4>
                <p class="text-center">Date founded:
                    <span class="bump-size bolded-text" data-bind="text: founded"></span></p>
            </li>
        </ul>
    </div>
    <!-- Tabs work just like for the list-tabs above. -->
    <img id="twitter-tab" class="tab-plain tab-off twitter-tab-image" src="dist/images/twitter-tab.png"></img>
    <img id="twitter-tab-highlight" class="tab-highlight tab-off twitter-tab-image" src="dist/images/twitter-tab-highlight.png"></img>
    <img id="twitter-tab-back" class="tab-back tab-off twitter-tab-image" data-bind="click: slideTwitter" src="dist/images/tab-back.png"></img>
    <!-- This div features Twitter feed either from a list of all the theatres
        referenced in the app, or from one particular company. -->
    <div id="twitter-div" class="right-div-off right-divs">
        <!-- These buttons allow switches between the list and user feeds, and 
            between keeping the feed short or allowing Twitter to do a true feed
            with virtually endless tweets acccessed by scrolling down. -->
        <div class="button-flex">
            <div id="twitter-list-button" class="button-50 button-blue" data-bind=" click: switchTwitter">
                <!-- Text changes depending on whether a single account or the 
                    list of all accounts is being viewed. -->
                <span class="no-border" data-bind="visible: twitterListView">
                See Chosen Feed
                </span>
                <span class="no-border" data-bind="visible: !twitterListView()">
                See Combined Feed
                </span>
            </div>
            <div class="button-50 button-pink" data-bind="click: toggleTwitterLength">
                <!-- Text changes depending on the current state of the feed length -->
                <span class="no-border" data-bind="visible: twitterLong">
                Collapse Feed
                </span>
                <span class="no-border" data-bind="visible: !twitterLong()">
                Expand Feed
                </span>
            </div>
        </div>
        <!-- List view -->
        <div id="twitter-list" class="scroll-div" data-bind="visible: twitterListView() && twitterIsOpen">
        </div>
        <!-- Reference to which account we are on for user-view -->
        <div id="twitter-account-header" data-bind="text: currentTitle, visible: !twitterListView() && twitterIsOpen"></div>
        <!-- User view -->
        <div id="twitter-account" class="scroll-div" data-bind="visible: !twitterListView() && twitterIsOpen">
        </div>
        <!-- Error appears behind the other divs and will display 1.5 seconds
            after switching views or feed lengths if there is some problem in 
            loading the feeds. -->
        <div id="twitter-error" class="scroll-div">
            <!-- User view error message -->
            <div data-bind="visible: !twitterListView() && twitterIsOpen">
                <span class="large-font">Hmmm!</span> We're trying to load the Twitter feed for the account <span class="italic-font" data-bind="text: activeTwitter"></span>. If this message persists, try clicking on another marker on the map to reload. If this fails, there might be some error in the connection!
            </div>
            <!-- List view error message -->
            <div data-bind="visible: twitterListView() && twitterIsOpen">
                <span class="large-font">Hmmm!</span> We're trying to load a list of Twitter accounts connected to Toronto Theatre. If this message persists, there might be some issue connecting to Twitter. Sorry for the inconvenience. You can check out the list on the Twitter webpage <a href="https://twitter.com/BreathMachine/lists/toronto-theatre">by clicking here</a>.
            </div>
        </div>
    </div>
    <!-- Tabs work like the list and twitter tabs above. -->
    <img id="filter-tab" class="tab-plain tab-off filter-tab-image" src="dist/images/filter-tab.png"></img>
    <img id="filter-tab-highlight" class="tab-highlight tab-off filter-tab-image" src="dist/images/filter-tab-highlight.png"></img>
    <img id="filter-tab-back" class="tab-back tab-off filter-tab-image" data-bind="click: slideFilter" src="dist/images/tab-back.png"></img>
    <!-- This div features buttons to filter the theatres presented based on 
        interests. -->
    <div id="filter-div" class="right-div-off right-divs">
        <!-- Reset filters -->
        <div class="button-flex">
            <div class="button-100 button-black" data-bind=" click: clearFilters">
                Uncheck all
            </div>
        </div>
        <!-- All filter options -->
        <ul class="button-filter-flex scroll-div" data-bind="foreach: filters">
            <li class="button-filter-item" data-bind="click: $root.toggleFilter,
            text: flag, css: { buttonOn: filter() }">
                <!-- We apply the buttonOn class when the observable 'filter' is
                'true' -->
            </li>
        </ul>
    </div>
    <footer>
        <!-- Attributions for the icons used -->
        <span id="credit-marker" data-bind="click: slideCredits">Credits</span>
        <div id="credit-div" data-bind="css: { creditDivOn: creditOn() } ">
            <div class="attributions">Icons made by <a href="http://www.freepik.com" title="Freepik">Freepik</a> from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0">CC BY 3.0</a>
            </div>
            <div class="attributions">Icons made by <a href="http://www.flaticon.com/authors/icomoon" title="Icomoon">Icomoon</a> from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0">CC BY 3.0</a>
            </div>
            <div class="button-100 button-black" data-bind=" click: slideCredits">
                Dismiss
            </div>
        </div>
    </footer>
</body>

</html>
